<!-- C:\Users\jonat\Documents\gestion_docs\plantillas_documentos_tecnicos\templates\crear_tipo_documento.html -->
{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container mt-4">
    <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Crear Tipo de Documento Técnico</h4>
        </div>

        <div class="card-body">
            {% if messages %}
                <div class="mb-3">
                    {% for message in messages %}
                        <div class="alert 
                            {% if message.tags == 'error' %}alert-danger
                            {% elif message.tags == 'success' %}alert-success
                            {% else %}alert-info{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <form method="POST" novalidate>
                {% csrf_token %}

                <!-- Categoría -->
                <div class="mb-3">
                    <label for="categoria_id" class="form-label fw-bold">Categoría del Documento</label>
                    <select class="form-select" id="categoria_id" name="categoria_id" required>
                        <option value="">-- Selecciona una categoría --</option>
                        {% for cat in categorias %}
                            <option value="{{ cat.id }}">{{ cat.nombre }} ({{ cat.abreviatura }})</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Nombre -->
                <div class="mb-3">
                    <label for="nombre" class="form-label fw-bold">Nombre del Tipo de Documento</label>
                    <input type="text" class="form-control" id="nombre" name="nombre" 
                           placeholder="Ejemplo: Informe Técnico, Acta de Reunión, etc." required>
                </div>

                <!-- Descripción -->
                <div class="mb-3">
                    <label for="descripcion" class="form-label fw-bold">Descripción</label>
                    <textarea class="form-control" id="descripcion" name="descripcion" rows="3"
                              placeholder="Describe brevemente el propósito o uso del documento."></textarea>
                </div>

                <!-- Abreviatura generada automáticamente -->
                <div class="mb-3">
                    <label for="abreviatura" class="form-label fw-bold">Abreviatura (sigla)</label>
                    <input type="text" class="form-control readonly-field" id="abreviatura" name="abreviatura"
                           placeholder="Se generará automáticamente..." readonly>
                    <small class="form-text text-muted">
                        La abreviatura se genera automáticamente a partir del nombre y debe ser única dentro de la categoría.
                    </small>
                </div>

                <!-- Botones -->
                <div class="text-end">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-save"></i> Crear
                    </button>
                    
                    <a href="{% url 'plantillas:lista_plantillas' %}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Volver
                    </a>
                </div>

            </form>
        </div>
    </div>

    <!-- Guía de nomenclatura -->
    <div class="mt-5">
        <h5 class="fw-bold">Guía de Nomenclatura</h5>
        <p>
            Cada tipo de documento técnico debe seguir reglas claras para su nombre y abreviatura:
        </p>
        <ul>
            <li>El nombre debe contener solo texto alfabético (sin números, símbolos ni caracteres especiales).</li>
            <li>Usa palabras significativas; evita artículos y conectores innecesarios (y, de, del, la, los, etc.).</li>
            <li>No inventes abreviaturas arbitrarias; el sistema genera la sigla representativa.</li>
        </ul>

        <h6 class="mt-3 fw-bold">Ejemplos comunes</h6>
        <table class="table table-bordered table-sm mt-2">
            <thead class="table-light">
                <tr>
                    <th>Tipo de Documento</th>
                    <th>Nomenclatura</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Acta de Reunión</td><td>ACTA</td></tr>
                <tr><td>Matriz de Riesgo</td><td>MATR</td></tr>
                <tr><td>Informe Técnico</td><td>INF</td></tr>
                <tr><td>Planes de Medio Ambiente</td><td>PLANMA</td></tr>
                <tr><td>Procedimientos e Instructivos Operacionales</td><td>PROC</td></tr>
                <tr><td>Reporte Semanal</td><td>REPS</td></tr>
            </tbody>
        </table>
    </div>
</div>

<style>
.readonly-field {
    background-color: #f1f1f1;
    color: #555;
    cursor: not-allowed;
    border: 1px solid #ccc;
}
</style>

<script>
const nombreInput = document.getElementById('nombre');
const abreviaturaInput = document.getElementById('abreviatura');

// Generación automática de abreviatura
nombreInput.addEventListener('input', function() {
    let nombre = this.value.trim();
    nombre = nombre.replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ\s]/g, '');
    const palabras = nombre.split(/\s+/).filter(p => p.length > 0);

    let abreviatura = '';
    if (palabras.length === 1) {
        abreviatura = palabras[0].substring(0, 4).toUpperCase();
    } else if (palabras.length > 1) {
        abreviatura = palabras.slice(0, 4).map(p => p[0].toUpperCase()).join('');
    }

    abreviaturaInput.value = abreviatura;
});
</script>

{% endblock %}
