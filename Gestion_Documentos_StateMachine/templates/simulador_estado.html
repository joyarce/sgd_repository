{% extends "base.html" %}
{% load custom_filters %}

{% block title %}Simulador de Estados{% endblock %}

{% block content %}
<div style="max-width:700px;margin:40px auto;font-family:'Inter', sans-serif;">
    <h1>Simulador de Estados</h1>

    <!-- Estado actual -->
    <p><strong>Estado actual:</strong> {{ estado_actual }}</p>

    <!-- Mensaje de transición -->
    {% if mensaje %}
        <div style="padding:10px;background:#f0f0f0;border-radius:5px;margin-bottom:10px;">
            {{ mensaje }}
        </div>
    {% endif %}

    <!-- Acciones disponibles -->
    <h3>Acciones disponibles</h3>
    <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:15px;">
        {% for evento in todos_eventos %}
            {% if evento in eventos %}
                <a href="?estado={{ estado_actual }}&evento={{ evento }}&rol={{ rol_id }}" 
                   style="padding:8px 12px;background:#007bff;color:#fff;text-decoration:none;border-radius:5px;">
                    {{ evento|capfirst }}
                </a>
            {% else %}
                <span style="padding:8px 12px;background:#ccc;color:#666;border-radius:5px;" 
                      title="{{ mensajes_estado|get_item:evento }}">
                    {{ evento|capfirst }}
                </span>
            {% endif %}
        {% endfor %}
    </div>

    <!-- Simular rol -->
    <h3>Simular rol</h3>
    <div style="margin-top:10px;">
        <a href="?estado={{ estado_actual }}&rol=1" style="margin-right:5px;">Redactor</a>
        <a href="?estado={{ estado_actual }}&rol=2" style="margin-right:5px;">Revisor</a>
        <a href="?estado={{ estado_actual }}&rol=3">Aprobador</a>
    </div>

    <!-- Historial de cambios de estado -->
    <h3>Historial de cambios de estado</h3>
    {% if historial %}
        <ul style="background:#f9f9f9;padding:10px;border-radius:5px;">
            {% for item in historial%}
                <li>
                    {{ forloop.counter }}. Evento: <strong>{{ item.evento|capfirst }}</strong> → Nuevo estado: <strong>{{ item.nuevo_estado }}</strong>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No hay historial registrado.</p>
    {% endif %}

    <!-- Botón para reiniciar historial -->
    <a href="?estado={{ estado_actual }}&rol={{ rol_id }}&reset_historial=1" 
       style="display:inline-block;margin-top:10px;padding:5px 10px;background:#dc3545;color:#fff;border-radius:5px;text-decoration:none;">
       Reiniciar historial
    </a>


</div>
{% endblock %}
