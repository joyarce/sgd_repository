{% extends "base.html" %}

{% block title %}Detalle Documento{% endblock %}

{% block extra_css %}
<style>
/* Contenedor principal */
.container { max-width:1000px; margin:40px auto; padding:0 20px; font-family:'Inter', sans-serif; }

/* Bot√≥n volver */
.btn-back { margin-bottom:25px; }
.btn-secondary { 
    background:#6c757d; 
    color:#fff; 
    padding:10px 18px; 
    border-radius:8px; 
    text-decoration:none; 
    font-weight:600;
    transition:0.2s; 
    display:inline-block;
}
.btn-secondary:hover { background:#495057; }

/* T√≠tulos */
h1 { text-align:center; font-weight:700; margin-bottom:25px; font-size:1.8rem; color:#212529; }
h2 { font-weight:600; margin-top:35px; margin-bottom:20px; border-bottom:2px solid #e0e0e0; padding-bottom:6px; font-size:1.2rem; color:#343a40; }

/* Cards de m√©tricas */
.stats-container { display:flex; flex-wrap:wrap; gap:18px; margin-bottom:35px; }
.stat-card { flex:1 1 160px; background:#f8f9fa; border-radius:14px; padding:18px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,0.08); transition:0.3s; }
.stat-card:hover { box-shadow:0 6px 16px rgba(0,0,0,0.12); transform: translateY(-2px); }
.stat-icon { font-size:2rem; margin-bottom:6px; color:#6c757d; }
.stat-value { font-size:1.6rem; font-weight:700; margin-bottom:4px; color:#212529; }
.stat-label { font-size:0.85rem; color:#495057; text-transform:uppercase; letter-spacing:0.5px; }

/* Secci√≥n de equipos */
.equipo-container { display:flex; flex-wrap:wrap; gap:22px; margin-bottom:35px; }
.equipo-card { flex:1 1 220px; background:#fff; border-radius:12px; padding:14px 20px; box-shadow:0 3px 8px rgba(0,0,0,0.06); transition:0.3s; }
.equipo-card:hover { box-shadow:0 6px 14px rgba(0,0,0,0.1); transform: translateY(-2px); }
.equipo-card h3 { font-size:1.05rem; margin-bottom:10px; color:#343a40; }
.equipo-card p { font-size:0.9rem; color:#555; }

/* Timeline visual + estilo de logs integrado */
.timeline { position:relative; margin:30px 0; padding-left:40px; }
.timeline::before {
    content:"";
    position:absolute;
    left:20px;
    top:0;
    width:4px;
    height:100%;
    background:#007bff;
    border-radius:2px;
}
.timeline-item {
    position:relative;
    margin-bottom:28px;
    padding-left:22px;
    transition:0.2s;
    background:#fff;
    border-radius:12px;
    padding:14px 18px;
    box-shadow:0 3px 8px rgba(0,0,0,0.06);
}
.timeline-item:hover { box-shadow:0 6px 14px rgba(0,0,0,0.12); transform: translateY(-2px); }
.timeline-item::before {
    content:"";
    position:absolute;
    left:-28px;
    top:10px;
    width:18px;
    height:18px;
    border-radius:50%;
    background:#007bff;
    border:2px solid #fff;
}
.timeline-date { font-weight:600; margin-right:10px; font-size:0.85rem; color:#495057; }
.timeline-state { font-weight:600; font-size:0.95rem; display:block; margin-top:2px; color:#212529; }
.timeline-user { color:#343a40; font-size:0.85rem; display:block; margin-top:2px; }
.timeline-note { font-size:0.85rem; color:#555; margin-top:4px; font-style:italic; }

/* Colores por tipo de transici√≥n */
.estado-rechazado::before { background:#dc3545 !important; }
.estado-aprobado::before { background:#28a745 !important; }
.estado-publicado::before { background:#17a2b8 !important; }
</style>
{% endblock %}

{% block content %}
<div class="container">

    <div class="btn-back">
        <a href="javascript:history.back()" class="btn-secondary">‚Üê Volver al Proyecto</a>
    </div>

    <h1>{{ documento.tipo_documento }} - {{ documento.categoria }}</h1>

    <!-- Dashboard estad√≠stico -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon">‚úçÔ∏è</div>
            <div class="stat-value">{{ equipo_redactores|length }}</div>
            <div class="stat-label">Redactores</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üîç</div>
            <div class="stat-value">{{ equipo_revisores|length }}</div>
            <div class="stat-label">Revisores</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-value">{{ equipo_aprobadores|length }}</div>
            <div class="stat-label">Aprobadores</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìÑ</div>
            <div class="stat-value">{{ logs|length }}</div>
            <div class="stat-label">Acciones</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚úîÔ∏è</div>
            <div class="stat-value">{{ conteo_estados.Aprobado|default:"0" }}</div>
            <div class="stat-label">Aprobados</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-value">{{ conteo_estados.Rechazado|default:"0" }}</div>
            <div class="stat-label">Rechazados</div>
        </div>
    </div>

    <!-- Equipos -->
    <h2>Equipos del Ciclo de Vida</h2>
    <div class="equipo-container">
        <div class="equipo-card">
            <h3>Redactores</h3>
            <p>{% if equipo_redactores %}{{ equipo_redactores|join:", " }}{% else %}<span class="text-muted">No hay redactores asignados</span>{% endif %}</p>
        </div>
        <div class="equipo-card">
            <h3>Revisores</h3>
            <p>{% if equipo_revisores %}{{ equipo_revisores|join:", " }}{% else %}<span class="text-muted">No hay revisores asignados</span>{% endif %}</p>
        </div>
        <div class="equipo-card">
            <h3>Aprobadores</h3>
            <p>{% if equipo_aprobadores %}{{ equipo_aprobadores|join:", " }}{% else %}<span class="text-muted">No hay aprobadores asignados</span>{% endif %}</p>
        </div>
    </div>

    <!-- Timeline + Logs integrados -->
    <h2>Timeline del Ciclo de Vida</h2>
    <div class="timeline">
        {% for log in logs %}
        <div class="timeline-item 
                    {% if 'Rechazado' in log.estado_destino %}estado-rechazado
                    {% elif 'Aprobado' in log.estado_destino %}estado-aprobado
                    {% elif 'Publicado' in log.estado_destino %}estado-publicado{% endif %}">
            <span class="timeline-date">{{ log.fecha_accion|date:"d/m/Y H:i" }}</span>
            <span class="timeline-state">{{ log.estado_origen }} ‚Üí {{ log.estado_destino }}</span>
            <span class="timeline-user">
                {{ log.usuario_nombre }}{% if log.rol_usuario %} ({{ log.rol_usuario }}){% endif %}
            </span>
            {% if log.observaciones %}
            <div class="timeline-note">Observaci√≥n: {{ log.observaciones }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

</div>
{% endblock %}
