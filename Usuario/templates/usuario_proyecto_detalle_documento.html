{% extends "base.html" %}

{% block title %}Detalle Documento{% endblock %}

{% block extra_css %}
<style>
/* Contenedor principal */
.container { max-width:1000px; margin:40px auto; padding:0 20px; font-family:'Inter', sans-serif; }

/* Bot√≥n volver */
.btn-back { margin-bottom:25px; }
.btn-secondary { 
    background:#6c757d; 
    color:#fff; 
    padding:8px 16px; 
    border-radius:6px; 
    text-decoration:none; 
    font-weight:500;
    transition:0.2s; 
}
.btn-secondary:hover { background:#495057; }

/* T√≠tulos */
h1 { text-align:center; font-weight:700; margin-bottom:20px; }
h2 { font-weight:600; margin-top:30px; margin-bottom:15px; border-bottom:1px solid #e0e0e0; padding-bottom:5px; }

/* Cards de m√©tricas */
.stats-container { display:flex; flex-wrap:wrap; gap:15px; margin-bottom:30px; }
.stat-card { flex:1 1 150px; background:#f8f9fa; border-radius:12px; padding:15px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.08); transition:0.2s; }
.stat-card:hover { box-shadow:0 4px 12px rgba(0,0,0,0.12); }
.stat-icon { font-size:1.8rem; margin-bottom:5px; color:#6c757d; }
.stat-value { font-size:1.5rem; font-weight:700; margin-bottom:3px; }
.stat-label { font-size:0.85rem; color:#495057; text-transform:uppercase; letter-spacing:0.5px; }

/* Tarjeta de documento */
.card { background:#fff; border-radius:12px; padding:20px 25px; box-shadow:0 4px 12px rgba(0,0,0,0.05); margin-bottom:30px; }
.card p { margin:6px 0; font-size:0.95rem; color:#555; }
.card .info-label { font-weight:600; color:#333; margin-right:5px; }

/* Secci√≥n de equipos */
.equipo-container { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:30px; }
.equipo-card { flex:1 1 200px; background:#fff; border-radius:10px; padding:12px 18px; box-shadow:0 2px 6px rgba(0,0,0,0.06); }
.equipo-card h3 { font-size:1rem; margin-bottom:8px; color:#343a40; }
.equipo-card p { font-size:0.9rem; color:#555; }

/* Timeline */
.timeline { border-left:2px solid #007bff; margin:30px 0; padding-left:20px; }
.timeline-item { position:relative; margin-bottom:18px; }
.timeline-item::before { content:""; position:absolute; left:-9px; top:5px; width:16px; height:16px; background:#007bff; border-radius:50%; }
.timeline-date { font-weight:600; margin-right:10px; font-size:0.85rem; color:#495057; }
.timeline-state { font-style:italic; color:#555; font-size:0.85rem; }
.timeline-user { color:#343a40; margin-left:8px; font-size:0.85rem; }

/* Tabla historial */
table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.05); margin-bottom:50px; }
th, td { padding:10px 12px; text-align:left; font-size:0.85rem; }
th { background:#f1f3f5; font-weight:600; text-transform:uppercase; color:#495057; }
tbody tr:nth-child(even) { background:#f9f9f9; }
tbody tr:hover { background:#fff3e0; }
.estado-rechazado { background:#f8d7da !important; color:#721c24; font-weight:600; }
.estado-aprobado { background:#d4edda !important; color:#155724; font-weight:600; }

</style>
{% endblock %}

{% block content %}
<div class="container">

    <div class="btn-back">
        <a href="javascript:history.back()" class="btn-secondary">‚Üê Volver al Proyecto</a>
    </div>

    <h1>{{ documento.tipo_documento }} - {{ documento.categoria }}</h1>

    <!-- Dashboard estad√≠stico compacto -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon">‚úçÔ∏è</div>
            <div class="stat-value">{{ equipo_redactores|length }}</div>
            <div class="stat-label">Redactores</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üîç</div>
            <div class="stat-value">{{ equipo_revisores|length }}</div>
            <div class="stat-label">Revisores</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-value">{{ equipo_aprobadores|length }}</div>
            <div class="stat-label">Aprobadores</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìÑ</div>
            <div class="stat-value">{{ logs|length }}</div>
            <div class="stat-label">Acciones</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚úîÔ∏è</div>
            <div class="stat-value">{{ conteo_estados.Aprobado|default:"0" }}</div>
            <div class="stat-label">Aprobados</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-value">{{ conteo_estados.Rechazado|default:"0" }}</div>
            <div class="stat-label">Rechazados</div>
        </div>
    </div>

    <!-- Equipos -->
    <h2>Equipos del Ciclo de Vida</h2>
    <div class="equipo-container">
        <div class="equipo-card">
            <h3>Redactores</h3>
            <p>{% if equipo_redactores %}{{ equipo_redactores|join:", " }}{% else %}<span class="text-muted">No hay redactores asignados</span>{% endif %}</p>
        </div>
        <div class="equipo-card">
            <h3>Revisores</h3>
            <p>{% if equipo_revisores %}{{ equipo_revisores|join:", " }}{% else %}<span class="text-muted">No hay revisores asignados</span>{% endif %}</p>
        </div>
        <div class="equipo-card">
            <h3>Aprobadores</h3>
            <p>{% if equipo_aprobadores %}{{ equipo_aprobadores|join:", " }}{% else %}<span class="text-muted">No hay aprobadores asignados</span>{% endif %}</p>
        </div>
    </div>

    <!-- Timeline -->
    <h2>Timeline del Ciclo de Vida</h2>
    <div class="timeline">
        {% for log in logs %}
        <div class="timeline-item">
            <span class="timeline-date">{{ log.fecha_accion|date:"d/m/Y H:i" }}</span>
            <span class="timeline-state">{{ log.estado_destino }}</span>
            <span class="timeline-user">({{ log.usuario_nombre }})</span>
        </div>
        {% endfor %}
    </div>

    <!-- Historial de estados -->
    <h2>Ciclo de Vida del Documento</h2>
    <table>
        <thead>
            <tr>
                <th>Usuario</th>
                <th>Rol</th>
                <th>Estado Origen</th>
                <th>Estado Destino</th>
                <th>Fecha Cambio</th>
                <th>Observaciones</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.usuario_nombre }}</td>
                <td>{{ log.rol_usuario }}</td>
                <td>{{ log.estado_origen }}</td>
                <td class="{% if 'Rechazado' in log.estado_destino %}estado-rechazado{% elif 'Aprobado' in log.estado_destino %}estado-aprobado{% endif %}">{{ log.estado_destino }}</td>
                <td>{{ log.fecha_accion|date:"d/m/Y H:i" }}</td>
                <td>{{ log.observaciones }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-muted">No hay historial de estados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% endblock %}
