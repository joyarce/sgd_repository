{% extends "base.html" %}

{% block title %}Repositorio Google Cloud Storage{% endblock %}

{% block extra_css %}
<style>
:root {
    --metso-dark-gray: #333;
    --metso-white: #fff;
    --metso-orange: #f36f21;
    --metso-blue: #007bff;
}

/* CONTENEDOR */
.container {
    max-width: 1100px;
    margin: 30px auto;
    padding: 0 15px;
    font-family: "Inter", sans-serif;
}

/* TÍTULO */
h1 {
    text-align: center;
    color: var(--metso-dark-gray);
    font-size: 1.7rem;
    font-weight: 600;
}

/* BREADCRUMB estilo SharePoint */
.breadcrumb-box {
    display: flex;
    gap: 6px;
    margin: 15px 0;
    font-size: 0.9rem;
}

.crumb {
    color: var(--metso-blue);
    font-weight: 600;
    text-decoration: none;
}

.crumb:hover {
    text-decoration: underline;
}

.crumb.active {
    color: var(--metso-dark-gray);
}

.separator {
    color: #666;
}

/* PANEL SUPERIOR */
.tools-panel {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--metso-white);
    padding: 12px 18px;
    border-radius: 8px;
    border: 1px solid #eee;
    margin-bottom: 15px;
}

.tools-panel button {
    background: var(--metso-orange);
    color: #fff;
    border: none;
    padding: 7px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
}

/* LINK SUBIR NIVEL */
.back-link {
    color: var(--metso-dark-gray);
    font-size: 0.9rem;
    text-decoration: none;
}

/* GRID DE ARCHIVOS + CARPETAS (estilo SharePoint liviano) */
.tiles-grid {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
}

/* TARJETAS */
.tile {
    background: white;
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #eee;
    cursor: pointer;
    text-align: center;
    transition: transform 0.12s;
}

.tile:hover {
    transform: translateY(-2px);
}

.tile-icon {
    font-size: 32px;
    margin-bottom: 6px;
}

.folder-tile .tile-icon {
    color: #f7c843;
}

.file-tile .tile-icon {
    color: #4e8ae8;
}

.tile-name {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--metso-dark-gray);
    word-break: break-word;
}

/* OVERLAY GLOBAL */
#overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.35);
    z-index: 9000;
}
</style>
{% endblock %}

{% block content %}
<div class="container">

    <h1>Repositorio de Documentos</h1>

    <!-- Breadcrumb -->
    <nav class="breadcrumb-box">
        {% for name, path in breadcrumb %}
            {% if not forloop.last %}
                <a class="crumb" href="?folder={{ path }}">{{ name }}</a>
                <span class="separator">›</span>
            {% else %}
                <span class="crumb active">{{ name }}</span>
            {% endif %}
        {% endfor %}
    </nav>

    <!-- Panel superior -->
    <div class="tools-panel">
        <div>
            <button id="toggleFolderBtn"><i class="fas fa-folder-plus"></i> Nueva Carpeta</button>
            <button id="toggleUploadBtn"><i class="fas fa-upload"></i> Subir Archivo</button>
        </div>

        {% if current_folder and parent_folder %}
        <a href="?folder={{ parent_folder }}" class="back-link">
            ◀ Subir un nivel
        </a>
        {% endif %}
    </div>

    <!-- Vista estilo SharePoint -->
    <div class="tiles-grid">

        {% for folder in folders %}
        <div class="tile folder-tile" onclick="location='?folder={{ folder.id }}'">
            <div class="tile-icon"><i class="fas fa-folder"></i></div>
            <div class="tile-name">{{ folder.name }}</div>
        </div>
        {% endfor %}

        {% for file in files %}
        <div class="tile file-tile" onclick="window.open('{{ file.preview_url }}','_blank')">
            <div class="tile-icon"><i class="fas fa-file"></i></div>
            <div class="tile-name">{{ file.name }}</div>
        </div>
        {% endfor %}

    </div>

    <div id="overlay"></div>

</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const overlay = document.getElementById("overlay");

    document.getElementById("toggleFolderBtn").onclick = () => {
        overlay.style.display = "block";
        alert("Modal carpeta pendiente");
    };

    document.getElementById("toggleUploadBtn").onclick = () => {
        overlay.style.display = "block";
        alert("Modal subir archivo pendiente");
    };

    overlay.onclick = () => {
        overlay.style.display = "none";
    };
});
</script>
{% endblock %}
