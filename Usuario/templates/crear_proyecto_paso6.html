{% load dict_extras %}
<div class="step-inner">
    <h3>Paso 6: Confirmación de Datos</h3>

    {% if not proyecto_temp %}
        <p>No se encontraron datos guardados en la sesión. Revisa los pasos anteriores.</p>
    {% else %}
        <!-- Datos Generales -->
        <h4>Datos Generales</h4>
        <p><strong>Nombre:</strong> {{ proyecto_temp.nombre|default:"-" }}</p>
        <p><strong>Descripción:</strong> {{ proyecto_temp.descripcion|default:"-" }}</p>
        <p><strong>Fecha Inicio:</strong> {{ proyecto_temp.fecha_inicio|date:"d/m/Y"|default:"-" }}</p>
        <p><strong>Fecha Fin:</strong> {{ proyecto_temp.fecha_fin|date:"d/m/Y"|default:"-" }}</p>
        <p><strong>Administrador:</strong>
            {% for u in usuarios_administrador %}
                {% if u.id|stringformat:"s" == proyecto_temp.administrador|stringformat:"s" %}
                    {{ u.nombre }}
                {% endif %}
            {% endfor %}
        </p>
        <p><strong>Número de Orden:</strong> {{ proyecto_temp.numero_orden|default:"-" }}</p>

        <!-- Contrato -->
        <h4>Contrato</h4>
        <p><strong>Número de Contrato:</strong> {{ proyecto_temp.numero_contrato|default:"-" }}</p>
        <p><strong>Monto Total:</strong> {{ proyecto_temp.monto_total|default:"-" }}</p>
        <p><strong>Fecha Creación Contrato:</strong> {{ proyecto_temp.fecha_creacion|date:"d/m/Y"|default:"-" }}</p>

        <!-- Cliente -->
        <h4>Cliente</h4>
        <p><strong>Nombre:</strong> {{ proyecto_temp.cliente_nombre|default:"-" }}</p>
        <p><strong>RUT:</strong> {{ proyecto_temp.cliente_rut|default:"-" }}</p>
        <p><strong>Dirección:</strong> {{ proyecto_temp.cliente_direccion|default:"-" }}</p>
        <p><strong>Correo:</strong> {{ proyecto_temp.cliente_correo|default:"-" }}</p>
        <p><strong>Teléfono:</strong> {{ proyecto_temp.cliente_telefono|default:"-" }}</p>

        <!-- Máquinas -->
        <h4>Máquinas</h4>
        {% if proyecto_temp.maquinas %}
        <ul>
            {% for m_id in proyecto_temp.maquinas %}
                {% for m in maquinas %}
                    {% if m.id|stringformat:"s" == m_id|stringformat:"s" %}
                        <li>{{ m.nombre }}</li>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </ul>
        {% else %}
            <p>No hay máquinas seleccionadas.</p>
        {% endif %}

        <!-- Grupos y Documentos -->
        <h4>Grupos y Documentos</h4>
        {% if proyecto_temp.grupos %}
        <ul>
            {% for grupo in proyecto_temp.grupos %}
                <li>
                    <strong>{{ grupo.nombre }}</strong>
                    <ul>
                        {% for doc in grupo.documentos %}
                            <li>
                                {{ doc.nombre }}<br>
                                <small>
                                    Redactor: {{ doc.redactor|default:"-" }} |
                                    Revisor: {{ doc.revisor|default:"-" }} |
                                    Aprobador: {{ doc.aprobador|default:"-" }}
                                </small>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
        {% else %}
            <p>No hay grupos asignados.</p>
        {% endif %}

        <!-- Botones de navegación -->
        <div style="text-align:center; margin-top:20px;">
            <a href="{% url 'usuario:crear_proyecto' %}" class="button-link">← Anterior</a>
            <form method="POST" style="display:inline;">{% csrf_token %}
                <button type="submit" class="btn">Confirmar y Crear Proyecto</button>
            </form>
        </div>
    {% endif %}
</div>
