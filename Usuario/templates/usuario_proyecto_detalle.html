{% extends "base.html" %}

{% block title %}Dashboard del Proyecto{% endblock %}

{% block extra_css %}
<style>
/* --- Contenedor principal --- */
.container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 15px;
    font-family: 'Poppins', sans-serif;
}

/* --- Cabecera --- */
h1 {
    text-align: center;
    font-weight: 700;
    margin-bottom: 30px;
    font-size: 2rem;
    color: #333;
}

/* --- Botón volver --- */
.btn-back { margin-bottom: 25px; }
.btn-secondary {
    background: #6c757d;
    color: #fff;
    padding: 8px 20px;
    border-radius: 6px;
    text-decoration: none;
    transition: 0.2s;
}
.btn-secondary:hover { background: #5a6268; }

/* --- Tarjetas --- */
.card {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 20px;
    margin-bottom: 20px;
}
.card h2 {
    font-size: 1.2rem;
    margin-bottom: 15px;
    color: #f36f21;
    border-bottom: 2px solid #f36f21;
    padding-bottom: 5px;
}

/* --- Indicadores --- */
.indicator {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    word-break: break-word;
}
.indicator span { font-weight: 600; }

/* --- Layout horizontal para Contrato y Cliente --- */
.row-horizontal {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}
.row-horizontal .card {
    flex: 1 1 48%;
    min-width: 280px;
}

/* --- Máquinas con scroll --- */
.table-scroll {
    overflow-x: auto;
}
.table-scroll table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}
table th, table td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; font-size: 0.9rem; }
table th { background: #f7f9fb; font-weight: 700; text-transform: uppercase; }
table tr:hover { background: #fdf2e8; }

/* --- Requerimientos de documentos --- */
.section-docs table th, .section-docs table td { font-size: 0.88rem; }

/* --- Mensajes vacíos --- */
.text-muted { text-align:center; color:#777; padding:15px; font-style:italic; }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="btn-back">
        <a href="{% url 'usuario:lista_proyectos' %}" class="btn-secondary">← Volver a Proyectos</a>
    </div>

    <h1>{{ proyecto.nombre_proyecto }}</h1>

    <!-- Información del Proyecto -->
    <div class="card">
        <h2>Información del Proyecto</h2>
        <div class="indicator"><span>Descripción:</span> <span>{{ proyecto.proyecto_descripcion }}</span></div>
        <div class="indicator"><span>Número de Orden:</span> <span>{{ proyecto.numero_orden }}</span></div>
        <div class="indicator"><span>Administrador:</span> <span>{{ proyecto.administrador_nombre_completo }} ({{ proyecto.administrador_email }})</span></div>
        <div class="indicator"><span>Faena:</span> <span>{{ proyecto.nombre_faena }}</span></div>
        <div class="indicator"><span>Fecha Inicio:</span> <span>{{ proyecto.fecha_inicio|date:"d/m/Y" }}</span></div>
        <div class="indicator"><span>Fecha Fin:</span> <span>{{ proyecto.fecha_fin|date:"d/m/Y"|default:"(Sin fecha)" }}</span></div>
    </div>

    <!-- Contrato y Cliente lado a lado -->
    <div class="row-horizontal">
        <div class="card">
            <h2>Información del Contrato</h2>
            <div class="indicator"><span>Número de Contrato:</span> <span>{{ proyecto.numero_contrato }}</span></div>
            <div class="indicator"><span>Monto Total:</span> <span>{{ proyecto.monto_total }}</span></div>
            <div class="indicator"><span>Fecha Creación:</span> <span>{{ proyecto.contrato_fecha_creacion|date:"d/m/Y" }}</span></div>
            <div class="indicator"><span>Representante:</span> <span>{{ proyecto.representante_cliente_nombre }}</span></div>
            <div class="indicator"><span>Email:</span> <span>{{ proyecto.representante_cliente_correo }}</span></div>
            <div class="indicator"><span>Teléfono:</span> <span>{{ proyecto.representante_cliente_telefono }}</span></div>
        </div>

        <div class="card">
            <h2>Información del Cliente</h2>
            <div class="indicator"><span>Nombre:</span> <span>{{ proyecto.cliente_nombre }}</span></div>
            <div class="indicator"><span>RUT:</span> <span>{{ proyecto.cliente_rut }}</span></div>
            <div class="indicator"><span>Dirección:</span> <span>{{ proyecto.cliente_direccion }}</span></div>
            <div class="indicator"><span>Correo:</span> <span>{{ proyecto.cliente_correo }}</span></div>
            <div class="indicator"><span>Teléfono:</span> <span>{{ proyecto.cliente_telefono }}</span></div>
        </div>
    </div>

    <!-- Máquinas Asociadas con scroll horizontal -->
    <div class="card table-scroll">
        <h2>Máquinas Asociadas</h2>
        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Código</th>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Año</th>
                    <th>Tipo</th>
                    <th>Descripción</th>
                </tr>
            </thead>
            <tbody>
                {% for maquina in maquinas %}
                <tr>
                    <td>{{ maquina.nombre }}</td>
                    <td>{{ maquina.codigo_equipo }}</td>
                    <td>{{ maquina.marca }}</td>
                    <td>{{ maquina.modelo }}</td>
                    <td>{{ maquina.anio_fabricacion }}</td>
                    <td>{{ maquina.tipo }}</td>
                    <td>{{ maquina.descripcion }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="7" class="text-muted">No hay máquinas asociadas.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Requerimientos de Documentos -->
    <div class="card section-docs">
        <h2>Requerimientos de Documentos Técnicos</h2>
        <table>
            <thead>
                <tr>
                    <th>Documento Técnico</th>
                    <th>Estado Actual</th>
                    <th>Fecha Registro</th>
                </tr>
            </thead>
            <tbody>
                {% for req in requerimientos %}
                <tr 
                    style="cursor:pointer;"
                    onclick="window.location.href='{% url 'usuario:detalle_documento' req.id %}'"
                >
                    <td>{{ req.nombre_documento_tecnico }}</td>
                    <td>{{ req.estado_actual }}</td>
                    <td>{{ req.fecha_registro|date:"d/m/Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-muted">No hay documentos requeridos.</td>
                </tr>
                {% endfor %}
        
            </tbody>
        </table>
    </div>


</div>
{% endblock %}
